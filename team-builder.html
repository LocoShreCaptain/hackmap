<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Builder - HackMap</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between h-16">
                <div class="flex">
                    <div class="flex-shrink-0 flex items-center">
                        <a href="index.html" class="text-2xl font-bold text-indigo-600">HackMap</a>
                    </div>
                    <div class="hidden md:ml-6 md:flex md:space-x-8">
                        <a href="index.html" class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">Home</a>
                        <a href="browse.html" class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">Browse</a>
                        <a href="projects.html" class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">Projects</a>
                        <a href="team-builder.html" class="border-indigo-500 text-gray-900 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">Team Builder</a>
                    </div>
                </div>
                <div class="hidden md:ml-6 md:flex md:items-center">
                    <a href="notifications.html" class="p-1 rounded-full text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                        <span class="sr-only">View notifications</span>
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
                        </svg>
                    </a>
                    <div class="ml-3 relative">
                        <div id="auth-buttons">
                            <a href="login.html" class="text-gray-500 hover:text-gray-700 px-3 py-2 rounded-md text-sm font-medium">Login</a>
                            <a href="signup.html" class="bg-indigo-600 text-white hover:bg-indigo-700 px-4 py-2 rounded-md text-sm font-medium">Sign Up</a>
                        </div>
                        <div id="user-menu" class="hidden">
                            <a href="dashboard.html" class="text-gray-500 hover:text-gray-700 px-3 py-2 rounded-md text-sm font-medium">Dashboard</a>
                            <button id="logout-btn" class="text-gray-500 hover:text-gray-700 px-3 py-2 rounded-md text-sm font-medium">Logout</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Create Team Section -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <h2 class="text-2xl font-bold text-gray-900 mb-4">Create a Team</h2>
            <form id="create-team-form" class="space-y-4">
                <div>
                    <label for="team-name" class="block text-sm font-medium text-gray-700">Team Name</label>
                    <input type="text" id="team-name" name="team-name" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                </div>
                <div>
                    <label for="hackathon" class="block text-sm font-medium text-gray-700">Hackathon</label>
                    <select id="hackathon" name="hackathon" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                        <option value="">Select a hackathon</option>
                        <!-- Hackathon options will be dynamically inserted here -->
                    </select>
                </div>
                <div>
                    <label for="team-description" class="block text-sm font-medium text-gray-700">Team Description</label>
                    <textarea id="team-description" name="team-description" rows="3" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"></textarea>
                </div>
                <div>
                    <label for="project-idea" class="block text-sm font-medium text-gray-700">Link Project Idea (Optional)</label>
                    <select id="project-idea" name="project-idea" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                        <option value="">Select a project idea</option>
                        <!-- Project options will be dynamically inserted here -->
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Required Skills</label>
                    <div id="skills-container" class="flex flex-wrap gap-2">
                        <!-- Skill checkboxes will be dynamically inserted here -->
                    </div>
                </div>
                <button type="submit" class="w-full bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    Create Team
                </button>
            </form>
        </div>

        <!-- Find Team Section -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <h2 class="text-2xl font-bold text-gray-900 mb-4">Find a Team</h2>
            <div class="space-y-4">
                <div>
                    <label for="search-hackathon" class="block text-sm font-medium text-gray-700">Search by Hackathon</label>
                    <select id="search-hackathon" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                        <option value="">All Hackathons</option>
                        <!-- Hackathon options will be dynamically inserted here -->
                    </select>
                </div>
                <div>
                    <label for="search-skills" class="block text-sm font-medium text-gray-700">Search by Skills</label>
                    <select id="search-skills" multiple class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                        <!-- Skill options will be dynamically inserted here -->
                    </select>
                </div>
                <button id="search-teams" class="w-full bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    Search Teams
                </button>
            </div>
        </div>

        <!-- Teams List -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-2xl font-bold text-gray-900 mb-4">Available Teams</h2>
            <div id="teams-list" class="space-y-4">
                <!-- Team cards will be dynamically inserted here -->
            </div>
        </div>
    </div>

    <script src="js/data.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/app.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));

            // Get all hackathons and projects
            const hackathons = JSON.parse(localStorage.getItem('hackathons')) || [];
            const skills = JSON.parse(localStorage.getItem('skills')) || [];
            const projects = JSON.parse(localStorage.getItem('projectIdeas')) || [];

            // Handle create team form visibility
            const createTeamForm = document.getElementById('create-team-form');
            if (createTeamForm) {
                if (!currentUser) {
                    createTeamForm.innerHTML = `
                        <div class="text-center py-4">
                            <p class="text-gray-600 mb-4">Please log in to create a team.</p>
                            <a href="login.html" class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700">
                                Login to Continue
                            </a>
                        </div>
                    `;
                } else {
                    // Check for pre-selected project
                    const selectedProjectId = localStorage.getItem('selectedProjectId');
                    if (selectedProjectId) {
                        const selectedProject = projects.find(p => p.id === parseInt(selectedProjectId));
                        if (selectedProject) {
                            document.getElementById('project-idea').value = selectedProjectId;
                            // Pre-fill skills based on project's tech stack
                            selectedProject.techStack.forEach(tech => {
                                const skillCheckbox = document.querySelector(`input[name="skills"][value="${tech}"]`);
                                if (skillCheckbox) {
                                    skillCheckbox.checked = true;
                                }
                            });
                        }
                        // Clear the selected project from localStorage
                        localStorage.removeItem('selectedProjectId');
                    }

                    // Populate hackathon selectors
                    const hackathonOptions = hackathons.map(hackathon => 
                        `<option value="${hackathon.id}">${hackathon.title}</option>`
                    ).join('');

                    document.getElementById('hackathon').innerHTML += hackathonOptions;
                    document.getElementById('search-hackathon').innerHTML += hackathonOptions;

                    // Populate project selector
                    const projectOptions = projects.map(project => 
                        `<option value="${project.id}">${project.title}</option>`
                    ).join('');
                    document.getElementById('project-idea').innerHTML += projectOptions;

                    // Populate skills
                    const skillsContainer = document.getElementById('skills-container');
                    skillsContainer.innerHTML = skills.map(skill => `
                        <label class="inline-flex items-center">
                            <input type="checkbox" name="skills" value="${skill}" class="rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
                            <span class="ml-2 text-sm text-gray-700">${skill}</span>
                        </label>
                    `).join('');

                    // Populate skills search
                    const skillsSearch = document.getElementById('search-skills');
                    skillsSearch.innerHTML = skills.map(skill => 
                        `<option value="${skill}">${skill}</option>`
                    ).join('');

                    // Handle team creation
                    createTeamForm.addEventListener('submit', (e) => {
                        e.preventDefault();

                        const teamName = document.getElementById('team-name').value;
                        const hackathonId = parseInt(document.getElementById('hackathon').value);
                        const description = document.getElementById('team-description').value;
                        const projectId = document.getElementById('project-idea').value;
                        const selectedSkills = Array.from(document.querySelectorAll('input[name="skills"]:checked'))
                            .map(checkbox => checkbox.value);

                        const newTeam = {
                            id: Date.now(),
                            name: teamName,
                            hackathonId,
                            description,
                            projectId: projectId ? parseInt(projectId) : null,
                            requiredSkills: selectedSkills,
                            members: [{
                                id: currentUser.id,
                                name: currentUser.name,
                                role: 'leader'
                            }],
                            status: 'recruiting'
                        };

                        // Update user's teams
                        if (!currentUser.teams) {
                            currentUser.teams = [];
                        }
                        currentUser.teams.push(newTeam);
                        localStorage.setItem('currentUser', JSON.stringify(currentUser));

                        // Update users array
                        const users = JSON.parse(localStorage.getItem('users')) || [];
                        const userIndex = users.findIndex(u => u.id === currentUser.id);
                        if (userIndex !== -1) {
                            users[userIndex] = currentUser;
                            localStorage.setItem('users', JSON.stringify(users));
                        }

                        showSuccess('Team created successfully!');
                        setTimeout(() => {
                            window.location.href = 'dashboard.html';
                        }, 1500);
                    });
                }
            }

            // Handle team search
            const searchTeamsBtn = document.getElementById('search-teams');
            if (searchTeamsBtn) {
                searchTeamsBtn.addEventListener('click', () => {
                    const selectedHackathon = document.getElementById('search-hackathon').value;
                    const selectedSkills = Array.from(document.getElementById('search-skills').selectedOptions)
                        .map(option => option.value);

                    // Get all teams from all users
                    const users = JSON.parse(localStorage.getItem('users')) || [];
                    const allTeams = users.flatMap(user => user.teams || []);

                    // Filter teams
                    let filteredTeams = allTeams;
                    if (selectedHackathon) {
                        filteredTeams = filteredTeams.filter(team => team.hackathonId === parseInt(selectedHackathon));
                    }
                    if (selectedSkills.length > 0) {
                        filteredTeams = filteredTeams.filter(team => 
                            selectedSkills.some(skill => team.requiredSkills.includes(skill))
                        );
                    }

                    // Display teams
                    const teamsList = document.getElementById('teams-list');
                    if (filteredTeams.length === 0) {
                        teamsList.innerHTML = '<p class="text-gray-500">No teams found matching your criteria.</p>';
                    } else {
                        teamsList.innerHTML = filteredTeams.map(team => {
                            const hackathon = hackathons.find(h => h.id === team.hackathonId);
                            const project = team.projectId ? projects.find(p => p.id === team.projectId) : null;
                            return `
                                <div class="bg-gray-50 rounded-lg p-4">
                                    <div class="flex justify-between items-start">
                                        <div>
                                            <h3 class="font-semibold text-gray-900">${team.name}</h3>
                                            <p class="text-sm text-gray-600">${hackathon ? hackathon.title : 'Unknown Hackathon'}</p>
                                            ${project ? `
                                                <p class="text-sm text-indigo-600 mt-1">
                                                    Project: ${project.title}
                                                </p>
                                            ` : ''}
                                        </div>
                                        <span class="px-2 py-1 text-sm rounded-full ${team.status === 'recruiting' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'}">
                                            ${team.status}
                                        </span>
                                    </div>
                                    <p class="mt-2 text-gray-600">${team.description}</p>
                                    <div class="mt-4">
                                        <h4 class="text-sm font-medium text-gray-900">Required Skills:</h4>
                                        <div class="flex flex-wrap gap-2 mt-1">
                                            ${team.requiredSkills.map(skill => `
                                                <span class="px-2 py-1 bg-indigo-100 text-indigo-800 text-sm rounded-full">
                                                    ${skill}
                                                </span>
                                            `).join('')}
                                        </div>
                                    </div>
                                    <div class="mt-4 flex justify-between items-center">
                                        <p class="text-sm text-gray-500">${team.members.length} members</p>
                                        ${currentUser ? `
                                            <button onclick="requestToJoin(${team.id})" class="text-indigo-600 hover:text-indigo-700 text-sm font-medium">
                                                Request to Join
                                            </button>
                                        ` : `
                                            <a href="login.html" class="text-indigo-600 hover:text-indigo-700 text-sm font-medium">
                                                Login to Join
                                            </a>
                                        `}
                                    </div>
                                </div>
                            `;
                        }).join('');
                    }
                });
            }

            // Function to handle join requests
            function requestToJoin(teamId) {
                if (!currentUser) {
                    showLoginPrompt();
                    return;
                }

                // Add join request logic here
                showSuccess('Join request sent!');
            }

            // Function to show login prompt
            function showLoginPrompt() {
                showError('Please log in to perform this action');
                setTimeout(() => {
                    window.location.href = 'login.html';
                }, 1500);
            }
        });
    </script>
</body>
</html> 